{"remainingRequest":"/home/beanyon/Desktop/workspace/time-partner/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/beanyon/Desktop/workspace/time-partner/src/components/Analysis.vue?vue&type=style&index=0&id=80c8f5e8&scoped=true&lang=css&","dependencies":[{"path":"/home/beanyon/Desktop/workspace/time-partner/src/components/Analysis.vue","mtime":1556259612441},{"path":"/home/beanyon/Desktop/workspace/time-partner/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/home/beanyon/Desktop/workspace/time-partner/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/beanyon/Desktop/workspace/time-partner/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/beanyon/Desktop/workspace/time-partner/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/beanyon/Desktop/workspace/time-partner/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.abstract {\n  width: 100%;\n  margin: 18px 0;\n}\n\n.abstract-item {\n  width: 50%;\n  display: inline-block;\n  margin-bottom: 20px;\n  font-size: 16px;\n  line-height: 14px;\n  letter-spacing: 2px;\n}\n\n.abstract-item p {\n  color: #e6a23c;\n  font-size: 32px;\n  font-weight: bold;\n  margin: 24px 0;\n}\n\n.charts:nth-child(1) {\n  margin-top: 30px;\n}\n\n.chart-title-proportion {\n  margin: 40px;\n}\n\n.chart-title-trendency {\n  margin: 0;\n}\n\n",{"version":3,"sources":["Analysis.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsPA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"Analysis.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <mu-container>\n    <!-- TitleBar -->\n    <mu-appbar style=\"width: 100%;\" color=\"primary\" title=\"数据分析\">\n      <mu-button icon slot=\"left\" @click=\"back()\">\n        <mu-icon value=\"chevron_left\"></mu-icon>\n      </mu-button>\n      <router-link to=\"/sign-in\" slot=\"right\" style=\"color: #fff;height: inherit;\">\n        <mu-button flat>筛选</mu-button>\n      </router-link>\n    </mu-appbar>\n    <!-- Main Content -->\n    <mu-container>\n      <mu-card class=\"abstract\">\n        <mu-card-title :title=\"abstract.title\" :sub-title=\"abstract.subTitle\"></mu-card-title>\n        <div class=\"abstract-item\"><p>{{abstract.numActivity}}</p>工作数</div>\n        <div class=\"abstract-item\"><p>{{abstract.sumMinutes}}</p>时长(min)</div>\n      </mu-card>\n      <div class=\"charts\">\n        <h2 class=\"chart-title-proportion\">7日内工作占比</h2>\n        <div id=\"proportion\" :style=\"{width: '100%', height: '300px'}\"></div>\n      </div>\n      <div class=\"charts\">\n        <h2 class=\"chart-title-trendency\">7日内每日走势</h2>\n        <div id=\"trendency\" :style=\"{width: '100%', height: '300px'}\"></div>\n      </div>\n    </mu-container>\n  </mu-container>\n</template>\n<script>\n\nexport default {\n  name: 'Analysis',\n  data() {\n    return {\n      // 要获取的数据类型:1 日报，2 周报，3 月报\n      type: 1,\n      abstract: {\n        'type': 1,\n        'title': '数据总览',\n        'subTitle': '今日数据',\n        'numActivity': 0,\n        'sumMinutes': 0\n      },\n      // 阶段时间卡片按任务统计\n      timeCardSumsByActivity: [],\n      // 阶段时间卡片按日期统计\n      timeCardSumsByDate: [],\n      // 阶段总的分钟数\n      minutesSum: 0\n    }\n  },\n  methods: {\n    /**\n     * 获取数据\n     */\n    getData() {\n      this.$http.get(this.BASE_API + '/get-analysis-data?type=' + this.abstract.type).then(response => {\n        if (response.body.result) {\n          this.calcMinutesSum(response.body.data)\n          this.initTrendencyChart()\n          this.initProportionChart()\n        } else {\n          this.$toast.error(response.body.message)\n        }\n      })\n    },\n\n    /**\n     * 计算每天的分钟和\n     *\n     * @param timeCards 获取到的时间卡片\n     */\n    calcMinutesSum(timeCards) {\n      for(let timeCard of timeCards) {\n        // 时间卡片的总时间\n        let timeCardSum = 0\n\n        // 计算每张时间卡片的总时间\n        for(let timeSpan of timeCard.timeSpans) {\n          if(timeSpan.startTime && timeSpan.endTime) {\n            let span = timeSpan.endTime - timeSpan.startTime\n            let spanSum = span / 1000 / 60\n            // 时间卡片的总时间\n            timeCardSum += Math.ceil(spanSum)\n          }\n        }\n        timeCard.timeCardSum = timeCardSum\n        // 计算总的分钟数\n        this.abstract.sumMinutes += timeCardSum\n\n        // 计算同种任务在阶段内的总时间\n        if(this.timeCardSumsByActivity.length == 0) {\n          this.timeCardSumsByActivity.push(timeCard)\n        } else {\n          let exist = false\n          for(let timeCardRes of this.timeCardSumsByActivity) {\n            if(timeCardRes.activity == timeCard.activity) {\n              exist = true\n              timeCardRes.timeCardSum += timeCard.timeCardSum\n            }\n          }\n\n          if(!exist) {\n            this.timeCardSumsByActivity.push(timeCard)\n          }\n        }\n        this.abstract.numActivity = this.timeCardSumsByActivity.length\n\n        // 每一天的总时间\n        let todaySum = 0\n        timeCard.todaySum = todaySum\n\n        // 计算每一天的总时间\n        if(this.timeCardSumsByDate.length == 0) {\n          let date = new Date(timeCard.createdAt)\n          let daySum = {\n            'date': (date.getMonth()+1) + \"-\" + date.getDate(),\n            'minutes': timeCard.timeCardSum\n          }\n          this.timeCardSumsByDate.push(daySum)\n        } else {\n          let exist = false\n          for(let timeCardRes of this.timeCardSumsByDate) {\n            let dates = timeCardRes.date.split(\"-\")\n            let dateAnalysisMonth = dates[0]\n            let dateAnalysisDay = dates[1]\n            let dateCard = new Date(timeCard.createdAt)\n            if(parseInt(dateAnalysisMonth)-1 == dateCard.getMonth() && parseInt(dateAnalysisDay) == dateCard.getDate()){\n              exist = true\n              timeCardRes.minutes += timeCard.timeCardSum\n            }\n          }\n\n          if(!exist) {\n            let date = new Date(timeCard.createdAt)\n            let daySum = {\n              'date': (date.getMonth()+1) + \"-\" + date.getDate(),\n              'minutes': timeCard.timeCardSum\n            }\n            this.timeCardSumsByDate.push(daySum)\n          }\n        }\n      }\n    },\n\n    /**\n     * 初始化趋势折线图\n     */\n    initTrendencyChart() {\n      // 抽取要显示的数据\n      let dates = []\n      let lineData = []\n      for(let timeCard of this.timeCardSumsByDate) {\n        dates.push(timeCard.date)\n        lineData.push(timeCard.minutes)\n      }\n\n      // 基于准备好的dom，初始化echarts实例\n      var trendencyChart = this.echarts.init(document.getElementById('trendency'));\n      var trendencyOption = {\n        xAxis: {\n            type: 'category',\n            data: dates\n        },\n        yAxis: {\n            type: 'value'\n        },\n        series: [{\n            data: lineData,\n            type: 'line'\n        }]\n      };\n\n      // 绘制图表\n      trendencyChart.setOption(trendencyOption);\n    },\n\n    /**\n     * 初始化饼图\n     */\n    initProportionChart() {\n      // 抽取要显示的数据\n      let activities = []\n      let dates = []\n      let pieData = []\n      for(let timeCard of this.timeCardSumsByActivity) {\n        activities.push(timeCard.activity)\n        dates.push(timeCard.createdAt)\n        pieData.push({'value': timeCard.timeCardSum, 'name': timeCard.activity})\n      }\n\n      // 基于准备好的dom，初始化echarts实例\n      var trendencyChart = this.echarts.init(document.getElementById('proportion'));\n\n      let trendencyOption = {\n          tooltip: {\n              trigger: 'item',\n              formatter: \"{a} <br/>{b}: {c} ({d}%)\"\n          },\n          legend: {\n              orient: 'vertical',\n              x: 'left',\n              data: activities\n          },\n          series: [\n              {\n                  name:'时间卡片（分钟）',\n                  type:'pie',\n                  radius: ['50%', '70%'],\n                  avoidLabelOverlap: false,\n                  label: {\n                      normal: {\n                          show: false,\n                          position: 'center'\n                      },\n                      emphasis: {\n                          show: true,\n                          textStyle: {\n                              fontSize: '30',\n                              fontWeight: 'bold'\n                          }\n                      }\n                  },\n                  labelLine: {\n                      normal: {\n                          show: false\n                      }\n                  },\n                  data: pieData\n              }\n          ]\n      };\n\n      // 绘制图表\n      trendencyChart.setOption(trendencyOption);\n    }\n  },\n  mounted() {\n    this.getData()\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n.abstract {\n  width: 100%;\n  margin: 18px 0;\n}\n\n.abstract-item {\n  width: 50%;\n  display: inline-block;\n  margin-bottom: 20px;\n  font-size: 16px;\n  line-height: 14px;\n  letter-spacing: 2px;\n}\n\n.abstract-item p {\n  color: #e6a23c;\n  font-size: 32px;\n  font-weight: bold;\n  margin: 24px 0;\n}\n\n.charts:nth-child(1) {\n  margin-top: 30px;\n}\n\n.chart-title-proportion {\n  margin: 40px;\n}\n\n.chart-title-trendency {\n  margin: 0;\n}\n\n</style>\n"]}]}